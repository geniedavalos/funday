  <section id="projects">
    <div class="welcome">

      <h2 class="text-center">Welcome, {{currentUser?.firstName}}!</h2>
    </div>
    <h4 (click)="toggleCompany()">Manage Company <i *ngIf="!companyExpanded" class="fa fa-chevron-down" aria-hidden="true"></i><i *ngIf="companyExpanded" class="fa fa-chevron-up" aria-hidden="true"></i></h4>
    <div *ngIf="companyExpanded" class="overview">
      <form (submit)="editCompany(companyForm)" #companyForm="ngForm" name="editCompanyForm">
        <h4 (click)="toggleEditName()" *ngIf="!editingName" class="ml-4 text-info">{{currentCompany?.name}}</h4>
        <h4 *ngIf="editingName" class="ml-4"><input type="text" [(ngModel)]="currentCompany.name" name="name"></h4>
        <a *ngIf="editingName" (click)="toggleEditName()"><small>Cancel</small></a>
        <input *ngIf="editingName" type="submit">
      </form>
      <h5 class="ml-4">Departments</h5>
      <form (submit)="addDepartment(departmentForm)" #departmentForm="ngForm" name="addDepartmentForm">
        <input class="form-control ml-4" type="text" [(ngModel)]="newDepartment" name="new_department" required minlength="2" placeholder="Enter Department Name">
        <input [disabled]="departmentForm.invalid || currentCompany?.departments.includes(newDepartment)" type="submit" class="btn btn-secondary my-3 ml-4">
      </form>

      <!--Modal For All Deletes-->
      <div class="modal fade" id="deleteItem" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header text-center bg-danger">
              <h3 class="modal-title w-100 my-auto text-white">Are You Sure?</h3>
              <button type="button" class="close text-white my-auto" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <p class='text-center'><strong>This action cannot be undone!</strong></p>
            </div>
            <div class="modal-footer justify-content-center">
              <button *ngIf="deletingDepartment" type="button" data-dismiss='modal' (click)='onDeleteDepartment()' class="btn btn-danger">Delete</button>
              <button *ngIf="deletingEmployee" type="button" data-dismiss='modal' (click)='onDeleteEmployee()' class="btn btn-danger">Delete</button>
            </div>
        </div>
      </div>
    </div>

      <table class="table text-center ml-4">
        <thead>
          <tr>
            <th>Name</th>
            <th>Members</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor='let department of currentCompany?.departments'>
            <td>{{department}}</td>
            <td>{{departmentMembership[department]}}</td>
            <td>
              <button *ngIf="department !== 'Unassigned'" data-toggle='modal' data-target='#deleteItem' (click)="setDeleteItem(department, 'department')" title='Delete Department' class="btn btn-outline-danger mx-1"><i class="fa fa-window-close" aria-hidden="true"></i></button>
            </td>
          </tr>
        </tbody>
      </table>

      <hr>
      <h5 class="ml-4">Management</h5>
      <table class="table text-center ml-4">
        <thead>
          <tr>
            <th>Name</th>
            <th>Managed Projects</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor='let manager of managers'>
            <td>{{manager.firstName}} {{manager.lastName}}</td>
            <td>{{manager.managedProjects.length}}</td>
            <td>
              <a [routerLink]="['']" routerLinkActive="router-link-active" title='Manager Profile' class="btn btn-outline-info mx-1"><i class="fa fa-search" aria-hidden="true"></i></a>
            </td>
          </tr>
        </tbody>
      </table>

    </div>
    <hr>
    <h4 (click)="toggleProjects()">Manage Projects <i *ngIf="!projectsExpanded" class="fa fa-chevron-down" aria-hidden="true"></i><i *ngIf="projectsExpanded" class="fa fa-chevron-up" aria-hidden="true"></i></h4>
    <div *ngIf="projectsExpanded" class="overview">
      <div *ngFor="let project of projects" class="project mt-4">
        <h4 class="ml-4 font-weight-normal"><a [routerLink]="['/projects/', project._id]">{{project.title}}</a></h4>
        <h5 class="ml-4 font-weight-normal">Lead: {{project.projectLead?.firstName}} {{project.projectLead?.lastName}}</h5>
        <h5 class="ml-4 font-weight-normal">Deadline: <span class="green">{{project.dueDate | date: 'mediumDate'}}</span></h5>
        <div class="progress mb-3 ml-4">
          <div class="progress-bar progress-bar-striped bg-info" role="progressbar" [ngStyle]="{'width': project?.progress+'%'}" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">{{project.progress}}</div>
        </div>
      </div>
    </div>
    <div *ngIf="projectsExpanded" class='row'>
        <button type="button" class="btn btn-primary mt-3 mx-auto" data-toggle="modal" data-target="#addProject">Add Project</button>
    </div>
    <hr>
    <h4 (click)="toggleEmployees()">Manage Employees <i *ngIf="!employeesExpanded" class="fa fa-chevron-down" aria-hidden="true"></i><i *ngIf="employeesExpanded" class="fa fa-chevron-up" aria-hidden="true"></i></h4>
    <div *ngIf="employeesExpanded" class="overview">
      <table class="table text-center ">
          <thead>
            <tr>
              <th scope="col">Name</th>
              <th scope="col">Department</th>
              <th scope="col">Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor='let member of currentCompany?.employees'>
              <td>{{member['firstName']}} {{member['lastName']}}</td>
              <td scope="row">{{member['department']}}</td>
              <td>
                <a [routerLink]="['']" routerLinkActive="router-link-active" title='Employee Profile' class="btn btn-outline-info mx-1"><i class="fa fa-search" aria-hidden="true"></i></a>
                <button *ngIf='member.isManager != true' (click)='makeManager(member._id)' title='Promote to Manager' class='btn btn-outline-primary mx-1'><i class="fa fa-handshake-o" aria-hidden="true"></i></button>
                <button data-toggle='modal' data-target='#editEmployee' (click)='setEditEmployee(member)' class="btn btn-outline-success mx-1" title='Edit Employee'><i class="fa fa-pencil" aria-hidden="true"></i></button>
                <button data-toggle='modal' data-target='#deleteItem' (click)="setDeleteItem(member._id, 'employee')" title='Remove Employee' class="btn btn-outline-danger mx-1"><i class="fa fa-window-close" aria-hidden="true"></i></button>
              </td>
            </tr>
          </tbody>
        </table>
    </div>

    <!--Edit Employee Modal-->
    <div class="modal fade" id="editEmployee" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header text-center bg-success">
              <h3 class="modal-title w-100 my-auto text-white">Edit Employee</h3>
              <button type="button" class="close text-white my-auto" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <p class='text-center'>Edit first name, last name and email</p>
              <div class="input-group mb-2 justify-content-center">
                  <div class="input-group-prepend">
                    <span class="input-group-text" id="basic-addon1"><i class="fa fa-user-o" aria-hidden="true"></i></span>
                  </div>
                <input type='text' value={{editItem?.firstName}} class='form-control col-8' [(ngModel)]='editItem.firstName'>
              </div>
              <div class="input-group mb-2 justify-content-center">
                  <div class="input-group-prepend">
                    <span class="input-group-text" id="basic-addon1"><i class="fa fa-user-o" aria-hidden="true"></i></span>
                  </div>
                <input type='text' value={{editItem?.lastName}} class='form-control col-8' [(ngModel)]='editItem.lastName'>
              </div>
              <div class="input-group mb-2 justify-content-center">
                  <div class="input-group-prepend">
                      <span class="input-group-text" id="basic-addon1"><i class="fa fa-envelope" aria-hidden="true"></i></span>
                  </div>
                <input type='text' value={{editItem?.email}} class='form-control col-8' [(ngModel)]='editItem.email'>
              </div>
              <hr>
                <p class='text-center'>Change Department</p>
                <div class='input-group mb-2 justify-content-center'>
                  <div class="input-group-prepend">
                    <span class="input-group-text" id="basic-addon1"><i class="fa fa-building" aria-hidden="true"></i></span>
                  </div>
                  <select class='form-control col-8' name='projectDept' [(ngModel)]='editItem.department'>
                      <option value="Unassigned">Unassigned</option>
                      <option *ngFor="let department of currentCompany?.departments" [hidden]="department === 'Unassigned'" value="{{department}}">{{department}}</option>
                  </select>
                </div>
            </div>
            <div class="modal-footer justify-content-center">
              <button type="button" data-dismiss='modal' (click)='onEditEmployee()' class="btn btn-sm btn-success px-3">Edit</button>
            </div>
        </div>
      </div>
    </div>

    <!--Modal For Adding New Projects-->
    <div class="modal fade" id="addProject" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header text-center bg-primary">
                  <h3 class="modal-title my-auto w-100 text-white">Create A Project</h3>
                  <button type="button" class="close my-auto text-white" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="modal-body">
                  <p class='text-center'><strong>Step 1</strong></p>
                  <p class='text-center'>Enter a due date, title and description</p>
                  <form #projectForm='ngForm' name='newProjectForm'>
                    <div class='input-group mb-2 justify-content-center'>
                      <div class="input-group-prepend">
                        <span class="input-group-text" id="basic-addon1"><i class="fa fa-calendar" aria-hidden="true"></i></span>
                      </div>
                      <input type='date'
                              class='form-control col-8'
                              name='date'
                              [(ngModel)]='newProject.dueDate'
                              #dueDate="ngModel"
                              required
                      >
                    </div>
                    <small class="mt-0" *ngIf="(dueDate.touched || dueDate.dirty) && dueDate.errors" >
                      <div *ngIf="dueDate?.errors?.required" class="alert alert-danger col-8 mx-auto">
                        Please enter a valid date.
                      </div>
                    </small>

                    <div class='input-group mb-2 justify-content-center'>
                      <div class="input-group-prepend">
                        <span class="input-group-text" id="basic-addon1"><i class="fa fa-terminal" aria-hidden="true"></i></span>
                      </div>
                      <input type='text' class='form-control col-8' name='title' [(ngModel)]='newProject.title'
                              placeholder="Title"
                              #title="ngModel"
                              minlength="3"
                              required
                      >
                      </div>
                      <small *ngIf="(title.touched || title.dirty) && title.errors" >
                        <div *ngIf="title?.errors?.required" class="alert alert-danger col-8 mx-auto">
                          Please enter a title.
                        </div>
                        <div *ngIf="title?.errors?.minlength" class="alert alert-danger col-8 mx-auto">
                          Title should be at least
                          {{ title?.errors?.minlength.requiredLength }} characters
                        </div>
                      </small>


                    <div class='input-group mb-2 justify-content-center'>
                      <div class="input-group-prepend">
                        <span class="input-group-text" id="basic-addon1"><i class="fa fa-pencil-square-o" aria-hidden="true"></i></span>
                      </div>
                      <textarea class='form-control col-8'
                              name='description'
                              [(ngModel)]='newProject.description'
                              placeholder="Description"
                              #description="ngModel"
                              minlength="3"
                              required
                      ></textarea>
                      </div>
                      <small *ngIf="(description.touched || description.dirty) && description.errors" >
                        <div *ngIf="description?.errors?.required" class="alert alert-danger col-8 mx-auto">
                          Please enter a project description.
                        </div>
                        <div *ngIf="description?.errors?.minlength" class="alert alert-danger col-8 mx-auto">
                          Description should be at least
                          {{ description?.errors?.minlength.requiredLength }} characters.
                        </div>
                      </small>

                    <hr>
                    <p class='text-center'><strong>Step 2</strong></p>
                      <p class='text-center'>Add Team Members</p>
                      <div class='input-group mb-2 justify-content-center'>
                        <div class="input-group-prepend">
                          <span class="input-group-text" id="basic-addon1"><i class="fa fa-building" aria-hidden="true"></i></span>
                        </div>
                        <select [(ngModel)]='selectedDepartments' multiple class='form-control col-8' name='projectDept'>
                            <option *ngFor="let department of currentCompany?.departments" value="{{department}}">{{department}}</option>
                        </select>
                      </div>

                      <form #addMembers="ngForm">
                        <div class='form-group row col-9 mx-auto'>
                          <select multiple class='form-control mx-auto' id='teamNames' name='member' [(ngModel)]='newMembers'>
                              <option *ngFor="let employee of employees" [hidden]="!selectedDepartments.includes(employee.department)" [disabled]="addedIds.includes(employee._id)" value="{{employee._id}}-{{employee.firstName}} {{employee.lastName}}">{{employee.firstName}} {{employee.lastName}}</option>
                          </select>
                        </div>
                        <div class='row'>
                          <button (click)='onAdd(addMembers)' class='btn btn-sm btn-success mt-3 mx-auto'>Add To Team</button>
                        </div>
                      </form>
                      <div class='addedMembers mt-3'>
                        <span *ngFor='let member of addedTeamMembers' class='badge badge-success mx-1'>{{ member }}</span>
                      </div>
                  </form>
                </div>
                <div class="modal-footer justify-content-center">
                  <button data-dismiss="modal" [disabled]='projectForm.invalid' (click)='onSubmit()' type="button" class="btn btn-primary px-5">Add Project!</button>
                </div>
            </div>
        </div>
    </div>
  </section>

  <!-- <footer>
    <div class="row map justify-content-center">
      <div class="col-lg-4 col-sm-6">
        <p><a [routerLink]="['/home']"><strong>Our product</strong></a></p>
        <p><a [routerLink]="['/home']" id="purpleh">Product</a></p>
        <p><a [routerLink]="['/home']" id="purpleh">Pricing</a></p>
      </div>

      <div class="col-lg-4 col-sm-6">
        <p><a [routerLink]="['/information']"><strong>Use Cases</strong></a></p>
        <p><a [routerLink]="['/information']" id="greenh">Product Management</a></p>
        <p><a [routerLink]="['/information']" id="greenh">Sample Use Cases</a></p>
      </div>

      <div class="col-lg-4 col-sm-6">
        <p><a [routerLink]="['/devTeam']"><Strong>Our Team</Strong></a></p>
        <p><a [routerLink]="['/devTeam']" id="blueh">About Us</a></p>
        <p><a [routerLink]="['/devTeam']" id="blueh">Contact Us</a></p>
      </div>
    </div>

    <div class="row">
      <div class="col-lg-6 col-sm-12 real-footer text-center">Made with <i class="fa fa-coffee" aria-hidden="true"></i> & <i class="fa fa-heart" aria-hidden="true"></i><br>
        All Rights Reserved Â© funday.com</div>
      <div class="col-lg-6 col-sm-12 real-footer justify-content-center">
        <div class="row social justify-content-center">
          <a href="https://www.facebook.com" id="facebook" class="fa fa-facebook" target="_blank"></a>
          <a href="https://www.twitter.com" id="twitter" class="fa fa-twitter" target="_blank"></a>
          <a href="https://www.youtube.com" id="youtube" class="fa fa-youtube" target="_blank"></a>
          <a href="https://www.skype.com" id="skype" class="fa fa-skype" target="_blank"></a>
        </div>
      </div>
    </div>
  </footer>
</div>

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script> -->
